name: pr_review_notice

on:
  pull_request_target:
    types: [opened, reopened]

permissions:
  contents: read
  # keep these, but weâ€™ll actually use PAT for the comment
  issues: write
  pull-requests: write

jobs:
  comment_review_notice:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          # PAT makes it work for fork PRs when GITHUB_TOKEN is blocked
          github-token: ${{ secrets.PR_COMMENT_TOKEN }}
          script: |
            const { owner, repo } = context.repo;

            const pr = context.payload.pull_request;
            const pr_number = pr.number;
            const pr_author = pr.user.login;

            const maintainers = ["ShahzaibAhmad05", "d-khalid"].map(u => u.toLowerCase());
            if (maintainers.includes(pr_author.toLowerCase())) return;

            const body =
              "Thank you for the pull request! âœ…\n\n" +
              "A maintainer will review this soon. Please be patient while we take a look. ðŸ™Œ";

            // Avoid duplicate comment spam
            const { data: comments } = await github.rest.issues.listComments({
              owner, repo, issue_number: pr_number, per_page: 100,
            });

            const already = comments.some(c => (c.body || "").includes("Thank you for the pull request! âœ…"));
            if (already) return;

            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: pr_number,
              body,
            });
